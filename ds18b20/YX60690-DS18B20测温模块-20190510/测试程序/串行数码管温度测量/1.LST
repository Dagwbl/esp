C51 COMPILER V9.00   1                                                                     08/03/2011 08:36:47 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE 1
OBJECT MODULE PLACED IN 1.OBJ
COMPILER INVOKED BY: E:\°²×°Èí¼þ\keil\C51\BIN\C51.EXE 1.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          /*********************************************************************************
   3          * ¡¾±àÐ´Ê±¼ä¡¿£º 2011.07.07
   4          * ¡¾×÷    Õß¡¿£º Ñãôáµç×Ó
   5          * ¡¾°æ    ±¾¡¿£º V1.0
   6          * ¡¾Íø    Õ¾¡¿£º http://ylelectronic.taobao.com/ 
   7          * ¡¾Q      Q¡¿£º 348439350
   8          * ¡¾Éù    Ã÷¡¿£º ´Ë³ÌÐò½öÓÃÓÚÑ§Ï°Óë²Î¿¼£¬ÒýÓÃÇë×¢Ã÷°æÈ¨ºÍ×÷ÕßÐÅÏ¢£¡
   9          * ¡¾º¯Êý¹¦ÄÜ¡¿£º ÀûÓÃµ¥ÏßÖÆDS18B20ÎÂ¶È´«¸ÐÆ÷  LEDÊýÂë¹ÜÏÔÊ¾µ±Ç°µÄÎÂ¶ÈÖµ                                                                             
  10          * ¡¾Ê¹ÓÃËµÃ÷¡¿£º ½«J1¶ÌÂ·Ã±¶Ì½Ó£¬Ñ¡ÔñÊýÂë¹ÜÄ£¿é
  11          **********************************************************************************/
  12          
  13          #include <reg51.h>                 //DS18B20ÎÂ¶È´«¸ÐÆ÷³ÌÐò 
  14          code unsigned char seg7code[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,
  15                                         0x82,0xf8,0x80,0x90,0xff}; //²»´øÐ¡ÊýµãµÄ¹²ÑôÊýÂë¹Ü¶ÎÂë
  16          code unsigned char seg7codeB[]={0x40,0x79,0x24,0x30,0x19,0x12,
  17                                         0x02,0x78,0x00,0x10,0xff}; //´øÐ¡ÊýµãµÄ¹²ÑôÊýÂë¹Ü¶ÎÂë
  18          
  19          unsigned char code fseg[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};  //²»´øÐ¡ÊýµãµÄ¹²ÑôÊýÂë¹Ü¶ÎÂ
             -ë
  20          unsigned char code fseg1[]={0x40,0x79,0x24,0x30,0x19,0x12,0x02,0x78,0x00,0x10}; //´øÐ¡ÊýµãµÄ¹²ÑôÊýÂë¹Ü¶ÎÂë
  21           unsigned char code segbit[]={0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01};
  22           unsigned char  disbuf[8]={0,0,0,0,0,0,0,0};
  23          
  24          /* º¯ÊýÉêÃ÷ -----------------------------------------------*/
  25          void delay(unsigned char i);
  26          void delay1ms(unsigned char i);
  27          void ReadTemperature(void);
  28          void Init_DS18B20(void);
  29          ReadOneChar();
  30          void WriteOneChar(unsigned char dat);
  31          void out(void);
  32          void sdata(void);
  33          
  34          /* ±äÁ¿¶¨Òå -----------------------------------------------*/
  35          sbit DQ=P3^6; //Êý¾Ý´«ÊäÏß½Óµ¥Æ¬»úµÄÏàÓ¦µÄÒý½Å 
  36          unsigned char tempL=0; //ÉèÈ«¾Ö±äÁ¿
  37          unsigned char tempH=0; 
  38          unsigned int sdate;//²âÁ¿µ½µÄÎÂ¶ÈµÄÕûÊý²¿·Ö
  39          unsigned char xiaoshu1;//Ð¡ÊýµÚÒ»Î»
  40          unsigned char xiaoshu2;//Ð¡ÊýµÚ¶þÎ»
  41          unsigned char xiaoshu;//Á½Î»Ð¡Êý
  42          bit  fg=1;        //ÎÂ¶ÈÕý¸º±êÖ¾
  43          
  44          sbit MOSIO=P2^2;
  45          sbit R_CLKa=P2^3;
  46          sbit S_CLKa=P2^4;
  47           unsigned char m;
  48          
  49          /*
  50          ********************************************************************************
  51          ** º¯ÊýÃû³Æ £º main(void)
  52          ** º¯Êý¹¦ÄÜ £º Ö÷º¯Êý
  53          ********************************************************************************
  54          */
C51 COMPILER V9.00   1                                                                     08/03/2011 08:36:47 PAGE 2   

  55          void main(void)
  56          {
  57   1       while(1)
  58   1       {
  59   2        ReadTemperature();
  60   2        sdata();
  61   2         out();
  62   2       
  63   2       }
  64   1      }
  65          
  66          
  67          /*
  68          ********************************************************************************
  69          ** º¯ÊýÃû³Æ £º delay(unsigned char i)
  70          ** º¯Êý¹¦ÄÜ £º ÑÓÊ±º¯Êý         Õâ¸öÑÓÊ±³ÌÐòµÄ¾ßÌåÑÓÊ±Ê±¼äÊÇtime=i*8+10,ÊÊÓÃÓÚÐ¡ÓÚ2msµÄÑÓÊ±
  71          ********************************************************************************
  72          */
  73          void delay(unsigned char i)
  74          {
  75   1              
  76   1              while(i--);
  77   1        
  78   1        
  79   1      }
  80          
  81          /*
  82          ********************************************************************************
  83          ** º¯ÊýÃû³Æ £º  delay1ms(unsigned char i)
  84          ** º¯Êý¹¦ÄÜ £º ÑÓÊ±º¯Êý 
  85          ********************************************************************************
  86          */
  87          void delay1ms(unsigned char i)
  88          {
  89   1       for(i=124;i>0;i--);  //ÑÓÊ±124*8+10=1002us
  90   1      }
  91          
  92          
  93          
  94          /*
  95          ********************************************************************************
  96          ** º¯ÊýÃû³Æ £º Init_DS18B20(void)
  97          ** º¯Êý¹¦ÄÜ £º ³õÊ¼»¯
  98          ********************************************************************************
  99          */
 100          void Init_DS18B20(void) 
 101          {
 102   1       unsigned char x=0;
 103   1       DQ=1; //DQÏÈÖÃ¸ß 
 104   1       delay(8); //ÉÔÑÓÊ±
 105   1       DQ=0; //·¢ËÍ¸´Î»Âö³å 
 106   1       delay(80); //ÑÓÊ±£¨>480us) 
 107   1       DQ=1; //À­¸ßÊý¾ÝÏß 
 108   1       delay(5); //µÈ´ý£¨15~60us) 
 109   1       x=DQ; //ÓÃXµÄÖµÀ´ÅÐ¶Ï³õÊ¼»¯ÓÐÃ»ÓÐ³É¹¦£¬18B20´æÔÚµÄ»°X=0£¬·ñÔòX=1 
 110   1       delay(20); 
 111   1      } 
 112          
 113          
 114          /*
 115          ********************************************************************************
 116          ** º¯ÊýÃû³Æ £º  ReadOneChar()
C51 COMPILER V9.00   1                                                                     08/03/2011 08:36:47 PAGE 3   

 117          ** º¯Êý¹¦ÄÜ £º ¶ÁÒ»¸ö×Ö½Ú
 118          ********************************************************************************
 119          */
 120           ReadOneChar()  //Ö÷»úÊý¾ÝÏßÏÈ´Ó¸ßÀ­ÖÁµÍµçÆ½1usÒÔÉÏ£¬ÔÙÊ¹Êý¾ÝÏßÉýÎª¸ßµçÆ½£¬´Ó¶ø²úÉú¶ÁÐÅºÅ
 121          {
 122   1      unsigned char i=0; //Ã¿¸ö¶ÁÖÜÆÚ×î¶ÌµÄ³ÖÐøÊ±¼äÎª60us£¬¸÷¸ö¶ÁÖÜÆÚÖ®¼ä±ØÐëÓÐ1usÒÔÉÏµÄ¸ßµçÆ½»Ö¸´ÆÚ
 123   1      unsigned char dat=0; 
 124   1      for (i=8;i>0;i--) //Ò»¸ö×Ö½ÚÓÐ8Î» 
 125   1      {
 126   2       DQ=1; 
 127   2       delay(1); 
 128   2       DQ=0;
 129   2       dat>>=1; 
 130   2       DQ=1; 
 131   2       if(DQ) 
 132   2       dat|=0x80; 
 133   2       delay(4);
 134   2      } 
 135   1      return(dat);
 136   1      } 
 137          
 138          
 139          /*
 140          ********************************************************************************
 141          ** º¯ÊýÃû³Æ £º WriteOneChar(unsigned char dat)
 142          ** º¯Êý¹¦ÄÜ £º Ð´Ò»¸ö×Ö½Ú
 143          ********************************************************************************
 144          */
 145          
 146          void WriteOneChar(unsigned char dat) 
 147          { 
 148   1        unsigned char i=0; //Êý¾ÝÏß´Ó¸ßµçÆ½À­ÖÁµÍµçÆ½£¬²úÉúÐ´ÆðÊ¼ÐÅºÅ¡£15usÖ®ÄÚ½«ËùÐèÐ´µÄÎ»ËÍµ½Êý¾ÝÏßÉÏ£¬
 149   1        for(i=8;i>0;i--) //ÔÚ15~60usÖ®¼ä¶ÔÊý¾ÝÏß½øÐÐ²ÉÑù£¬Èç¹ûÊÇ¸ßµçÆ½¾ÍÐ´1£¬µÍÐ´0·¢Éú¡£ 
 150   1        {
 151   2         DQ=0; //ÔÚ¿ªÊ¼ÁíÒ»¸öÐ´ÖÜÆÚÇ°±ØÐëÓÐ1usÒÔÉÏµÄ¸ßµçÆ½»Ö¸´ÆÚ¡£ 
 152   2         DQ=dat&0x01; 
 153   2         delay(5); 
 154   2         DQ=1; 
 155   2         dat>>=1;
 156   2        } 
 157   1        delay(4);
 158   1      } 
 159          
 160          
 161          /*
 162          ********************************************************************************
 163          ** º¯ÊýÃû³Æ £º ReadTemperature(void)
 164          ** º¯Êý¹¦ÄÜ £º ¶ÁÎÂ¶ÈÖµ£¨µÍÎ»·ÅtempL;¸ßÎ»·ÅtempH;£©
 165          ********************************************************************************
 166          */
 167          
 168          void ReadTemperature(void) 
 169          { 
 170   1       Init_DS18B20(); //³õÊ¼»¯
 171   1       WriteOneChar(0xcc); //Ìø¹ý¶ÁÐòÁÐºÅµÄ²Ù×÷
 172   1       WriteOneChar(0x44); //Æô¶¯ÎÂ¶È×ª»»
 173   1       delay(125); //×ª»»ÐèÒªÒ»µãÊ±¼ä£¬ÑÓÊ± 
 174   1       Init_DS18B20(); //³õÊ¼»¯
 175   1       WriteOneChar(0xcc); //Ìø¹ý¶ÁÐòÁÐºÅµÄ²Ù×÷ 
 176   1       WriteOneChar(0xbe); //¶ÁÎÂ¶È¼Ä´æÆ÷£¨Í·Á½¸öÖµ·Ö±ðÎªÎÂ¶ÈµÄµÍÎ»ºÍ¸ßÎ»£© 
 177   1       tempL=ReadOneChar(); //¶Á³öÎÂ¶ÈµÄµÍÎ»LSB
 178   1       tempH=ReadOneChar(); //¶Á³öÎÂ¶ÈµÄ¸ßÎ»MSB 
C51 COMPILER V9.00   1                                                                     08/03/2011 08:36:47 PAGE 4   

 179   1        
 180   1                      if(tempH>0x7f)      //×î¸ßÎ»Îª1Ê±ÎÂ¶ÈÊÇ¸º
 181   1                      {
 182   2                       tempL=~tempL;         //²¹Âë×ª»»£¬È¡·´¼ÓÒ»
 183   2                       tempH=~tempH+1;       
 184   2                       fg=0;      //¶ÁÈ¡ÎÂ¶ÈÎª¸ºÊ±fg=0
 185   2             }
 186   1                      sdate = tempL/16+tempH*16;      //ÕûÊý²¿·Ö
 187   1                      xiaoshu1 = (tempL&0x0f)*10/16; //Ð¡ÊýµÚÒ»Î»
 188   1                      xiaoshu2 = (tempL&0x0f)*100/16%10;//Ð¡ÊýµÚ¶þÎ»
 189   1                      xiaoshu=xiaoshu1*10+xiaoshu2; //Ð¡ÊýÁ½Î»
 190   1      
 191   1                      disbuf[3] =  sdate/10;
 192   1                      disbuf[2] =  sdate%10;
 193   1                      disbuf[1] =  xiaoshu1;
 194   1                      disbuf[0] =  xiaoshu2;
 195   1      
 196   1      }
 197          
 198          /*
 199          ********************************************************************************
 200          ** º¯ÊýÃû³Æ £º sdata(void)
 201          ** º¯Êý¹¦ÄÜ £º Êý¾Ý´«Êä
 202          ********************************************************************************
 203          */
 204           
 205          
 206          void sdata(void)
 207          {
 208   1              unsigned char b,c,num;
 209   1      
 210   1              if(b==0)
 211   1              {       
 212   2                b++;
 213   2                num=segbit[m];
 214   2                for(c=0;c<8;c++)
 215   2                {
 216   3                              S_CLKa=0;
 217   3                          MOSIO=num&0x80;
 218   3                          num<<=1;
 219   3                          S_CLKa=1;
 220   3                }
 221   2              
 222   2              } 
 223   1      
 224   1              if(b==1)
 225   1      
 226   1              {  
 227   2                  b--;
 228   2                if(m==2)
 229   2                {num=fseg1[disbuf[m]];}
 230   2                else
 231   2                 {num=fseg[disbuf[m]];}
 232   2      
 233   2                      for(c=0;c<8;c++)
 234   2                        {  S_CLKa=0;
 235   3                               MOSIO=num&0x80;
 236   3                               num<<=1;
 237   3                               S_CLKa=1;
 238   3                        }
 239   2              
 240   2              }
C51 COMPILER V9.00   1                                                                     08/03/2011 08:36:47 PAGE 5   

 241   1                   m++;
 242   1                   if(m==4)
 243   1                       {m=0;
 244   2                        }
 245   1       }
 246          
 247          
 248          
 249          /*
 250          ********************************************************************************
 251          ** º¯ÊýÃû³Æ £º out(void)
 252          ** º¯Êý¹¦ÄÜ £º Êý¾ÝÊä³ö
 253          ********************************************************************************
 254          */
 255          
 256          void out(void)
 257           { 
 258   1              R_CLKa=0;
 259   1          delay(1);
 260   1          R_CLKa=1;
 261   1       } 
 262          
 263          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    398    ----
   CONSTANT SIZE    =     50    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     16       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
